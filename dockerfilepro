# dockerfilepro (기존 유지하면서 아래만 수정)
FROM my-base:tf 

ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

WORKDIR /app

# Poetry 설치 및 종속성 설치
COPY pyproject.toml poetry.lock ./
RUN pip install poetry && \
    poetry config virtualenvs.create false && \
    poetry install --only main --no-interaction --no-ansi

# Django 프로젝트 복사
COPY django/ /app/django/

# 로그 폴더 생성 및 권한 설정
RUN mkdir -p /app/django/logs && \
    touch /app/django/logs/django_error.log && \
    chmod -R 777 /app/django/logs

WORKDIR /app/django

# 정적 파일 수집
RUN python manage.py collectstatic --noinput --settings=livflow.settings.product

EXPOSE 8000
CMD ["gunicorn", "livflow.wsgi:application", "--bind", "0.0.0.0:8000"]
